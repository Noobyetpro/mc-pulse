"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[588],{1989:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>d,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"deployment","title":"Deployment","description":"Production playbook for mc-pulse.","source":"@site/docs/deployment.md","sourceDirName":".","slug":"/deployment","permalink":"/docs/deployment","draft":false,"unlisted":false,"editUrl":"https://github.com/Noobyetpro/mc-pulse/tree/main/docs/docs/deployment.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"API keys and webhooks","permalink":"/docs/webhooks"}}');var i=s(4848),r=s(8453);const d={sidebar_position:5},l="Deployment",o={},c=[{value:"Quick deploy path",id:"quick-deploy-path",level:2},{value:"Environment and secrets",id:"environment-and-secrets",level:2},{value:"Systemd example (bare metal / VM)",id:"systemd-example-bare-metal--vm",level:2},{value:"Docker-style start",id:"docker-style-start",level:2},{value:"Database considerations",id:"database-considerations",level:2},{value:"Redis",id:"redis",level:2},{value:"Health and monitoring",id:"health-and-monitoring",level:2},{value:"Security tips",id:"security-tips",level:2}];function a(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"deployment",children:"Deployment"})}),"\n",(0,i.jsx)(n.p,{children:"Production playbook for mc-pulse."}),"\n",(0,i.jsx)(n.h2,{id:"quick-deploy-path",children:"Quick deploy path"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm install\nnpx prisma generate\nnpx prisma migrate deploy\nnpm run build\nPORT=3000 npm start\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Pair ",(0,i.jsx)(n.code,{children:"npm start"})," with a process manager (systemd, pm2, Docker, etc.)."]}),"\n",(0,i.jsx)(n.h2,{id:"environment-and-secrets",children:"Environment and secrets"}),"\n",(0,i.jsx)(n.p,{children:"Set these via your platform\u2019s secrets or environment:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Variable"}),(0,i.jsx)(n.th,{children:"Notes"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DATABASE_URL"})}),(0,i.jsxs)(n.td,{children:["Points to Postgres (uses ",(0,i.jsx)(n.code,{children:"mc_pulse"})," schema)."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"REDIS_URL"})}),(0,i.jsx)(n.td,{children:"Redis for Java cache. Service still boots without it, but Java lookups skip cache."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PORT"})}),(0,i.jsx)(n.td,{children:"Express listen port."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"CACHE_TTL_SECONDS"})}),(0,i.jsx)(n.td,{children:"Adjust freshness vs. Redis churn."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"DEFAULT_SERVER_HOST"})," / ",(0,i.jsx)(n.code,{children:"DEFAULT_SERVER_PORT"})]}),(0,i.jsx)(n.td,{children:"Fallbacks when host/port are omitted."})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"systemd-example-bare-metal--vm",children:"Systemd example (bare metal / VM)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"/etc/systemd/system/mc-pulse.service"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ini",children:"[Unit]\nDescription=mc-pulse API\nAfter=network.target\n\n[Service]\nType=simple\nWorkingDirectory=/opt/mc-pulse\nExecStart=/usr/bin/node dist/index.js\nEnvironment=PORT=3000\nEnvironment=DATABASE_URL=...\nEnvironment=REDIS_URL=...\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\n"})}),"\n",(0,i.jsx)(n.h2,{id:"docker-style-start",children:"Docker-style start"}),"\n",(0,i.jsx)(n.p,{children:"Build locally and run in a container:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'npm install\nnpx prisma generate\nnpx prisma migrate deploy\nnpm run build\n\ndocker run -d --name mc-pulse \\\n  -p 3000:3000 \\\n  -e PORT=3000 \\\n  -e DATABASE_URL="postgresql://..." \\\n  -e REDIS_URL="redis://..." \\\n  -v $(pwd)/dist:/app/dist \\\n  -w /app node:20-alpine \\\n  node dist/index.js\n'})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["For production images, bake dependencies and ",(0,i.jsx)(n.code,{children:"dist/"})," into the image instead of mounting them."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"database-considerations",children:"Database considerations"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Tables live in the ",(0,i.jsx)(n.code,{children:"mc_pulse"})," schema: ",(0,i.jsx)(n.code,{children:"Server"}),", ",(0,i.jsx)(n.code,{children:"StatusSnapshot"}),", ",(0,i.jsx)(n.code,{children:"ApiKey"}),", ",(0,i.jsx)(n.code,{children:"Webhook"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Each status check upserts a server and stores a snapshot; tune polling to manage growth."}),"\n",(0,i.jsxs)(n.li,{children:["No HTTP revoke endpoint yet: set ",(0,i.jsx)(n.code,{children:"revoked = true"})," on an API key in Postgres to disable it."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"redis",children:"Redis"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Only Java lookups hit Redis (Bedrock bypasses cache)."}),"\n",(0,i.jsx)(n.li,{children:"Startup continues if Redis is down; you will see warnings and cache skips in logs."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"health-and-monitoring",children:"Health and monitoring"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"GET /health"})," returns ",(0,i.jsx)(n.code,{children:'{ "ok": true }'}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Log webhook delivery results: responses include per-webhook status and errors to bubble up failures."}),"\n",(0,i.jsx)(n.li,{children:"Add reverse-proxy rate limiting if you expose the API publicly."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"security-tips",children:"Security tips"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Keep API keys server-side; do not embed them in frontends."}),"\n",(0,i.jsx)(n.li,{children:"Use a distinct API key per integration to rotate safely."}),"\n",(0,i.jsx)(n.li,{children:"Terminate TLS at your proxy or platform and enforce HTTPS for all clients."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>l});var t=s(6540);const i={},r=t.createContext(i);function d(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);