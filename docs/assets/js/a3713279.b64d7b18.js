"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[588],{1989:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"deployment","title":"Deploying on your own","description":"Official deployment is served from https://mc-pulse.vercel.app/ (no ports). Follow the steps below only when you need to run mc-pulse yourself; the hosted service already matches this behavior.","source":"@site/docs/deployment.md","sourceDirName":".","slug":"/deployment","permalink":"/docs/deployment","draft":false,"unlisted":false,"editUrl":"https://github.com/Noobyetpro/mc-pulse/tree/main/docs/docs/deployment.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Download & install","permalink":"/docs/download-and-install"},"next":{"title":"FAQ","permalink":"/docs/faq"}}');var r=s(4848),i=s(8453);const l={sidebar_position:5},d="Deploying on your own",o={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Local dev quickstart",id:"local-dev-quickstart",level:2},{value:"Quick deploy path (production)",id:"quick-deploy-path-production",level:2},{value:"Environment and secrets",id:"environment-and-secrets",level:2},{value:"Systemd example (bare metal / VM)",id:"systemd-example-bare-metal--vm",level:2},{value:"Docker-style start",id:"docker-style-start",level:2},{value:"Database considerations",id:"database-considerations",level:2},{value:"Redis",id:"redis",level:2},{value:"Health and monitoring",id:"health-and-monitoring",level:2},{value:"Security tips",id:"security-tips",level:2}];function a(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"deploying-on-your-own",children:"Deploying on your own"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["Official deployment is served from ",(0,r.jsx)(n.a,{href:"https://mc-pulse.vercel.app/",children:"https://mc-pulse.vercel.app/"})," (no ports). Follow the steps below only when you need to run mc-pulse yourself; the hosted service already matches this behavior."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Self-hosted production playbook for mc-pulse."}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Node.js ",(0,r.jsx)(n.strong,{children:"18+"})]}),"\n",(0,r.jsx)(n.li,{children:"Postgres (mc_pulse schema is used)"}),"\n",(0,r.jsx)(n.li,{children:"Redis (Java cache; optional but recommended)"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"local-dev-quickstart",children:"Local dev quickstart"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cp .env.example .env\nnpm install\nnpx prisma generate\nnpx prisma migrate dev\nnpm run dev\n"})}),"\n",(0,r.jsx)(n.p,{children:"Smoke-test:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl http://localhost:${PORT:-3000}/health\ncurl "http://localhost:${PORT:-3000}/api/status/java?host=arch.mc"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"quick-deploy-path-production",children:"Quick deploy path (production)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm install\nnpx prisma generate\nnpx prisma migrate deploy\nnpm run build\nPORT=3000 npm start\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Pair ",(0,r.jsx)(n.code,{children:"npm start"})," with a process manager (systemd, pm2, Docker, etc.)."]}),"\n",(0,r.jsx)(n.h2,{id:"environment-and-secrets",children:"Environment and secrets"}),"\n",(0,r.jsx)(n.p,{children:"Set these via your platform\u2019s secrets or environment:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Variable"}),(0,r.jsx)(n.th,{children:"Notes"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"DATABASE_URL"})}),(0,r.jsxs)(n.td,{children:["Points to Postgres (uses ",(0,r.jsx)(n.code,{children:"mc_pulse"})," schema)."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"REDIS_URL"})}),(0,r.jsx)(n.td,{children:"Redis for Java cache. Service still boots without it, but Java lookups skip cache."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"PORT"})}),(0,r.jsx)(n.td,{children:"Express listen port."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"CACHE_TTL_SECONDS"})}),(0,r.jsx)(n.td,{children:"Adjust freshness vs. Redis churn."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"DEFAULT_SERVER_HOST"})," / ",(0,r.jsx)(n.code,{children:"DEFAULT_SERVER_PORT"})]}),(0,r.jsx)(n.td,{children:"Fallbacks when host/port are omitted."})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"systemd-example-bare-metal--vm",children:"Systemd example (bare metal / VM)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"/etc/systemd/system/mc-pulse.service"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ini",children:"[Unit]\nDescription=mc-pulse API\nAfter=network.target\n\n[Service]\nType=simple\nWorkingDirectory=/opt/mc-pulse\nExecStart=/usr/bin/node dist/index.js\nEnvironment=PORT=3000\nEnvironment=DATABASE_URL=...\nEnvironment=REDIS_URL=...\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\n"})}),"\n",(0,r.jsx)(n.h2,{id:"docker-style-start",children:"Docker-style start"}),"\n",(0,r.jsx)(n.p,{children:"Build locally and run in a container:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'npm install\nnpx prisma generate\nnpx prisma migrate deploy\nnpm run build\n\ndocker run -d --name mc-pulse \\\n  -p 3000:3000 \\\n  -e PORT=3000 \\\n  -e DATABASE_URL="postgresql://..." \\\n  -e REDIS_URL="redis://..." \\\n  -v $(pwd)/dist:/app/dist \\\n  -w /app node:20-alpine \\\n  node dist/index.js\n'})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["For production images, bake dependencies and ",(0,r.jsx)(n.code,{children:"dist/"})," into the image instead of mounting them."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"database-considerations",children:"Database considerations"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Tables live in the ",(0,r.jsx)(n.code,{children:"mc_pulse"})," schema: ",(0,r.jsx)(n.code,{children:"Server"}),", ",(0,r.jsx)(n.code,{children:"StatusSnapshot"}),", ",(0,r.jsx)(n.code,{children:"ApiKey"}),", ",(0,r.jsx)(n.code,{children:"Webhook"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Each status check upserts a server and stores a snapshot; tune polling to manage growth."}),"\n",(0,r.jsxs)(n.li,{children:["No HTTP revoke endpoint yet: set ",(0,r.jsx)(n.code,{children:"revoked = true"})," on an API key in Postgres to disable it."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"redis",children:"Redis"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Only Java lookups hit Redis (Bedrock bypasses cache)."}),"\n",(0,r.jsx)(n.li,{children:"Startup continues if Redis is down; you will see warnings and cache skips in logs."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"health-and-monitoring",children:"Health and monitoring"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"GET /health"})," returns ",(0,r.jsx)(n.code,{children:'{ "ok": true }'}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Log webhook delivery results: responses include per-webhook status and errors to bubble up failures."}),"\n",(0,r.jsx)(n.li,{children:"Add reverse-proxy rate limiting if you expose the API publicly."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"security-tips",children:"Security tips"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Keep API keys server-side; do not embed them in frontends."}),"\n",(0,r.jsx)(n.li,{children:"Use a distinct API key per integration to rotate safely."}),"\n",(0,r.jsx)(n.li,{children:"Terminate TLS at your proxy or platform and enforce HTTPS for all clients."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>d});var t=s(6540);const r={},i=t.createContext(r);function l(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);